<!DOCTYPE html>
<html lang="en" ng-app="saya">
  <head>
    <meta charset="utf-8">
    <title>Saya</title>
    <link rel="icon" type="image/png" href="jellyfish.png">
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">

    <style type="text/css">
      html, body{ height: 100%; }
      #wrap{
        min-height: 100%;
        margin: 0 auto -60px;
      }
      #push, #footer{ height: 60px;              }
      #footer       { background-color: #f5f5f5; }
      #wrap > .container{ padding-top: 60px; }
      .container .credit{ margin: 20px 0;    }
      .editarea, textarea{
        width: 100%;
        max-width: 767px;
        height: 50vh;
      }
      @media(max-width: 979px){
        #wrap > .container{ padding-top: 0; }
        #footer{
          margin-left: -20px;
          margin-right: -20px;
          padding-left: 20px;
          padding-right: 20px;
        }
      }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular-cookies.min.js"></script>
    <script>
      angular.module('saya', ['ngCookies']);
      function auth($scope, $http, $cookies){
        ['twitter', 'facebook'].forEach(function(target){
          var checked = function(){
            return $scope[target + "_name"]() !== undefined;
          };
          $scope[target + '_checked'] = checked;
          $scope[target + '_as']      = function(){
            if(checked()) return 'as';
          };
          $scope[target + '_name']    = function(){
            return $cookies[target + '_name'];
          };

          $scope[target + '_auth'] = function(){
            if(checked()){
              $cookies[target + '_name'] = undefined;
            }
            else{
              $http.post('/api/auth/' + target).success(
                function(data){ window.location = data; });
            }
          };
        });
      };
    </script>

  </head>
  <body>
    <div id="wrap">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="active"><a href="/">Saya</a></li>
                <li><a href="#about" role="button" data-toggle="modal">About</a></li>
                <li><a href="https://github.com/godfat/saya">Source</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div> <!-- navbar -->

      <div class="container">
        <div id="about" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="aboutLabel" aria-hidden="true">
          <div class="modal-header"><h3 id="aboutLabel">About Saya</h3></div>
          <div class="modal-body">
            <p></p>
            <p>Saya is a product to provide a reference usage for <a href="https://github.com/godfat/jellyfish">Jellyfish</a>.</p>
          </div>
          <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          </div>
        </div> <!-- about -->

        <div class="main">
          <p>Say something to the following sites:</p>
          <form action="/api/post" method="post" ng-controller="auth">
            <label class="checkbox">
              <input type="checkbox" ng-click="twitter_auth()" ng-checked="twitter_checked()"/>
              Twitter {{twitter_as()}} <span class="label label-success">{{twitter_name()}}</span>
            </label>
            <label class="checkbox">
              <input type="checkbox" ng-click="facebook_auth()" ng-checked="facebook_checked()"/>
              Facebook {{facebook_as()}} <span class="label label-success">{{facebook_name()}}</span>
            </label>
            <div class="editarea">
              <p><textarea id="textarea"></textarea></p>
              <p class="pagination-centered"><button type="submit" class="btn">Say!</button></p>
            </div>
          </form>
        </div> <!-- main -->
      </div> <!-- container -->

      <div id="push"></div>
    </div> <!-- wrap -->

    <div id="footer">
      <div class="container">
        <p class="muted credit">Powered by <a href="https://github.com/godfat/jellyfish">Jellyfish</a> and <a href="https://github.com/cardinalblue/rest-more">rest-more</a>.</p>
      </div>
    </div> <!-- footer -->

    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
  </body>
</html>
